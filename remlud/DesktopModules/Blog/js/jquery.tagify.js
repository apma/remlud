
(function($){$.widget("ui.tagify",{options:{delimiters:[13,188],outputDelimiter:',',cssClass:'tagify-container',addTagPrompt:'add tags'},_create:function(){var self=this,el=self.element,opts=self.options;this.tags=[];this.tagInput=$("<input type='text'>").attr('placeholder',opts.addTagPrompt).keypress(function(e){var $this=$(this),pressed=e.which;for(i in opts.delimiters){if(pressed==opts.delimiters[i]){self.add($this.val());e.preventDefault();return false;}}}).keydown(function(e){self.keyDownValue=$(this).val();}).keyup(function(e){var $this=$(this),pressed=e.which;if(pressed==8){if(self.keyDownValue==''){self.remove();return false;}
return;}});this.tagDiv=$("<div></div>").addClass(opts.cssClass).click(function(){$(this).children('input').focus();}).append(this.tagInput).insertAfter(el.hide());var initVal=$.trim(el.val());if(initVal){var initTags=initVal.split(opts.outputDelimiter);$.each(initTags,function(i,tag){self.add(tag);});}},_setOption:function(key,value){options.key=value;},add:function(text){var self=this;text=text||self.tagInput.val();if(text){var tagIndex=self.tags.length;var removeButton=$("<a href='#'>x</a>").click(function(){self.remove(tagIndex);return false;});var newTag=$("<span></span>").text(text).append(removeButton);self.tagInput.after(newTag);self.tags.push(text);self.tagInput.val('');}
self.serialize();},remove:function(tagIndex){var self=this;if(tagIndex==null||tagIndex===(self.tags.length-1)){this.tagDiv.children("span").last().remove();self.tags.pop();}
if(typeof(tagIndex)=='number'){this.tagDiv.children("span:eq("+tagIndex+")").hide();delete(self.tags[tagIndex]);}
self.serialize();},serialize:function(){var self=this;var delim=self.options.outputDelimiter;var tagsStr=self.tags.join(delim);var dupes=new RegExp(delim+delim+'+','g');var ends=new RegExp('^'+delim+'|'+delim+'$','g');var outputStr=tagsStr.replace(dupes,delim).replace(ends,'');self.element.val(outputStr);return outputStr;},inputField:function(){return this.tagInput;},containerDiv:function(){return this.tagDiv;},destroy:function(){$.Widget.prototype.destroy.apply(this);this.tagDiv.remove();this.element.show();}});})(jQuery);